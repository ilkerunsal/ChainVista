# Security & Compliance Guidelines

This document outlines recommended practices for operating and extending the Blockchain Analytics AI project in a secure and compliant manner. While the codebase includes basic security features (tenant isolation, JWT authentication, CORS), a production deployment should adhere to these additional guidelines.

## Transport Security

- **TLS/HTTPS**: All client–server communication must occur over HTTPS to protect data in transit. Configure certificates at your load balancer or reverse proxy (e.g., Nginx, Traefik) and enforce HTTPS redirection in ASP.NET (`UseHttpsRedirection` and `UseHsts`).

## Authentication & Authorization

- **JWT validation**: Use strong signing keys and enable issuer/audience validation. Rotate keys periodically.
- **Tenant isolation**: Continue to propagate `tenant_id` through JWT claims or headers and apply per‑tenant filters at the data layer. Never trust client‑provided tenant identifiers without verification.
- **Role‑based access control**: Define roles (e.g., admin, analyst, viewer) and restrict API endpoints using `[Authorize(Roles="...")]` attributes.

## Input Validation & Injection Prevention

- **Query length**: The `/ask` endpoint enforces a maximum query length (2 kB). Adjust this limit based on business needs to prevent abuse.
- **Parameterization**: When executing SQL generated by the NL→SQL component, always parameterize values. Do not concatenate user input directly into SQL commands.
- **JSON schema validation**: Validate incoming request bodies against expected shapes (e.g., using FluentValidation or System.ComponentModel.DataAnnotations).

## Rate Limiting & Abuse Protection

- Implement rate limiting per IP/tenant/user to defend against denial‑of‑service and brute‑force attacks. ASP.NET offers [Rate Limiting Middleware](https://learn.microsoft.com/en-us/aspnet/core/performance/rate-limit) that can be configured via `AddRateLimiter`.
- Log and monitor suspicious patterns (e.g., repeated failed authentication attempts) and alert administrators when thresholds are exceeded.

## Secret Management

- Do not hard‑code secrets (API keys, DB credentials) in source control. Use a secret manager (Azure Key Vault, AWS Secrets Manager, HashiCorp Vault) and inject secrets via environment variables or managed identities.
- Rotate secrets regularly and restrict access based on the principle of least privilege.

## Logging & Monitoring

- Emit structured logs with timestamps, tenant identifiers, and trace IDs to track requests across services.
- Avoid logging sensitive information (passwords, access tokens). Mask or omit personally identifiable information (PII) in logs.
- Centralize logs and metrics using tools like Loki, Prometheus, and Grafana. Set up alerts for error rates, latency spikes, and resource exhaustion.

## Data Privacy & Compliance

- **Data minimization**: Store only the data required for analytics. For example, avoid retaining full wallet private keys or off‑chain personal data.
- **Right to erasure**: Implement mechanisms for users to request deletion of their data. This may involve deleting rows associated with a user’s `tenant_id` or anonymizing records.
- **Audit trail**: Maintain an immutable audit log of access and changes for compliance with regulations like GDPR and KVKK. Use a tamper‑evident log store or append‑only database.
- **Cross‑border transfers**: If operating across jurisdictions, ensure that data residency and cross‑border transfer requirements are met.

## Secure Deployment & Updates

- Use Infrastructure‑as‑Code (Terraform, Helm) to provision resources securely and reproducibly. Define network policies (firewalls, private subnets) to restrict access to databases and message queues.
- Apply security patches promptly to the OS, runtimes (.NET, Node.js), and dependencies. Use Dependabot or similar tools to monitor vulnerabilities.
- Run regular security scans (SAST/DAST) and penetration tests to uncover weaknesses.

By following these guidelines in addition to the built‑in security features of the codebase, you can enhance the resilience of the Blockchain Analytics AI system and ensure compliance with data protection laws.